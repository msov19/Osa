<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Potopa svƒõta</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    #textBox { font-size: 16px; }
    #voiceSelect { position: absolute; top: 1rem; right: 1rem; }
    .emoji-effect {
      position: fixed;
      font-size: 48px;
      animation: floatUp 2s ease-out forwards;
      pointer-events: none;
      z-index: 0;
    }
    @keyframes floatUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(-80px); }
    }
  </style>
</head>
<body class="bg-blue-100 flex flex-col items-center justify-center min-h-screen p-6 relative overflow-hidden">
  <select id="voiceSelect" class="px-4 py-2 rounded-lg border border-gray-300 shadow">
    <option>Naƒç√≠t√°m hlasy...</option>
  </select>

  <h1 class="text-3xl font-bold mb-4">Potopa svƒõta</h1>
  <img id="imageTrigger" src="images/potopa.png" alt="Potopa svƒõta" class="w-full max-w-md rounded-2xl shadow-lg mb-6 cursor-pointer" />
  <div id="textBox" class="bg-white p-4 rounded-xl shadow max-w-2xl text-center font-semibold text-gray-800 mb-4 hidden"></div>
  <div class="flex gap-4 mb-4">
    <button id="toggleRead" class="bg-green-600 text-white px-6 py-3 rounded-2xl shadow hover:bg-green-700 transition">
      ‚ñ∂Ô∏è Spustit ƒçten√≠
    </button>
  </div>
  <a href="index.html" class="bg-red-600 text-white px-8 py-4 rounded-2xl shadow hover:bg-red-700 transition text-xl font-bold">
    ‚Üê Zpƒõt na ƒçasovou osu
  </a>

  <script>
    const text = `Lid√© se na Zemi se mno≈æili, ale m√≠sto dobra zaƒç√≠nali b√Ωt sobeƒçt√≠, zl√≠ a zapom√≠nali na Boha. Stavƒõli si b≈Ø≈æky z kamene, klanƒõli se slunci a hvƒõzd√°m, starali se jen o sebe, h√°dali se a ubli≈æovali. B≈Øh vidƒõl, ≈æe lid√© opustili l√°sku, a rozhodl se svƒõt oƒçistit. Jen Noe se svou rodinou z≈Østal vƒõrn√Ω, a proto mu B≈Øh ≈ôekl, aby postavil archu ‚Äì velkou loƒè, kam vezme svou rodinu a z ka≈æd√©ho druhu zv√≠≈ôat p√°r (samce a samici).

Zaƒçalo pr≈°et. D√©≈°≈• pad√° dny a noci, voda stoup√°, a≈æ zakryje hory. Potopa smyla star√Ω svƒõt. Noe a zv√≠≈ôata z≈Øst√°vaj√≠ v bezpeƒç√≠ na ar≈°e. A≈æ voda opadla, Noe vypustil holubici, kter√° se vr√°tila s olivovou vƒõtviƒçkou ‚Äì znamen√≠m nov√©ho zaƒç√°tku.

Vƒõdci ≈ô√≠kaj√≠, ≈æe p≈ôed tis√≠ci lety opravdu do≈°lo k velk√© katastrofƒõ. Stejn√© vypr√°vƒõn√≠ jako v Bibli zn√°me i ze Sumeru, Indie, ƒå√≠ny nebo americk√Ωch indi√°n≈Ø.

B≈Øh lidem sl√≠bil, ≈æe u≈æ nikdy nezp≈Øsob√≠ tak velkou potopu. Duhou na nebi jim p≈ôipomnƒõl, ≈æe i kdy≈æ lid√© nƒõkdy dƒõlaj√≠ chyby, On je nenech√° samotn√© a a≈æ do konce jim nech√°v√° mo≈ænost se svobodnƒõ obr√°tit a polep≈°it.`;

    const toggleReadButton = document.getElementById('toggleRead');
    const textBox = document.getElementById('textBox');
    const voiceSelect = document.getElementById('voiceSelect');
    const imageTrigger = document.getElementById('imageTrigger');
    let utterance;
    let isPlaying = false;
    let sentenceList = [];
    let selectedVoiceIndex = 0;
    let paused = false;

    function splitIntoSentences(text) {
      return text.match(/[^.!?]+[.!?]+/g) || [text];
    }

    function populateVoices() {
      const voices = window.speechSynthesis.getVoices();
      voiceSelect.innerHTML = '';
      voices.filter(voice => voice.lang.startsWith('cs')).forEach((voice, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `${voice.name} (${voice.lang})`;
        if (index === selectedVoiceIndex) option.selected = true;
        voiceSelect.appendChild(option);
      });
    }

    voiceSelect.addEventListener('change', () => {
      selectedVoiceIndex = parseInt(voiceSelect.value);
      if (isPlaying) {
        window.speechSynthesis.cancel();
        isPlaying = false;
        textBox.innerHTML = '';
        textBox.classList.add('hidden');
        startReading();
      }
    });

    window.speechSynthesis.onvoiceschanged = populateVoices;
    populateVoices();

    function triggerEmoji(keyword) {
      const emojiMap = {
        b≈Øh: '‚ú®',
        noe: 'üë¥',
        archa: 'üö¢',
        loƒè: 'üõ∂',
        d√©≈°≈•: 'üåßÔ∏è',
        voda: 'üíß',
        holubice: 'üïäÔ∏è',
        duha: 'üåà',
        zv√≠≈ôata: 'üêæ',
        k√°men: 'ü™®',
        b≈Ø≈æky: 'üóø',
        slunci: '‚òÄÔ∏è',
        hvƒõzd√°m: 'üåü',
        l√°sku: '‚ù§Ô∏è',
        rodinou: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
        olivovou: 'üåø',
        zaƒç√°tku: 'üîÑ',
        p≈ô√≠bƒõhy: 'üìñ',
        potopu: 'üåä',
        chyby: '‚ö†Ô∏è',
        mo≈ænost: 'üÜì',
        svƒõt: 'üåç'
      };
      const match = Object.keys(emojiMap).find(key => keyword.toLowerCase().includes(key));
      if (match) {
        const emoji = emojiMap[match];
        const el = document.createElement('div');
        el.textContent = emoji;
        el.className = 'emoji-effect';
        el.style.left = `${Math.random() * 80 + 10}%`;
        el.style.bottom = '20px';
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 2000);
      }
    }

    function startReading() {
      const voices = window.speechSynthesis.getVoices().filter(v => v.lang.startsWith('cs'));
      utterance = new SpeechSynthesisUtterance(text);
      utterance.voice = voices[selectedVoiceIndex] || null;
      utterance.lang = 'cs-CZ';
      utterance.rate = 0.95;

      sentenceList = splitIntoSentences(text);
      isPlaying = true;
      paused = false;
      textBox.classList.remove('hidden');
      toggleReadButton.textContent = '‚è∏Ô∏è Pauza';

      utterance.onboundary = (event) => {
        if (event.name === 'word') {
          const charIndex = event.charIndex;
          let accumulated = 0;
          for (let i = 0; i < sentenceList.length; i++) {
            accumulated += sentenceList[i].length;
            if (accumulated >= charIndex) {
              const sentence = sentenceList[i].trim();
              textBox.innerHTML = sentence;
              triggerEmoji(sentence);
              break;
            }
          }
        }
      };

      utterance.onend = () => {
        isPlaying = false;
        toggleReadButton.textContent = '‚ñ∂Ô∏è Spustit ƒçten√≠';
        textBox.innerHTML = '';
        textBox.classList.add('hidden');
      };

      window.speechSynthesis.speak(utterance);
    }

    toggleReadButton.addEventListener('click', () => {
      if (!isPlaying) {
        startReading();
      } else if (!paused) {
        window.speechSynthesis.pause();
        paused = true;
        toggleReadButton.textContent = '‚ñ∂Ô∏è Pokraƒçovat';
      } else {
        window.speechSynthesis.resume();
        paused = false;
        toggleReadButton.textContent = '‚è∏Ô∏è Pauza';
      }
    });

    imageTrigger.addEventListener('click', () => {
      if (!isPlaying) {
        startReading();
      }
    });
  </script>
</body>
</html>
